# Система умных заметок

Названия: `notis`, `reminder`

## О системе
Платформа для ведения свох личных или рабочих заметок на подобии `notion`.

Функционал:
- Создавать разделы для заметок
- Пользователи могут создавать заметки, редактировать их
- Отслеживать историю изменения контента
- Делиться доступом к своим заметкам с другими пользователями
- Возможность оставлять комментарии, редактировать и удалять свои комментарии
- Видеть комментарии других людей
- Могут вести свои задачи, редактировать, менять статус

Приложение ДОЛЖНО:
- Предоставлять возможность `singin` и `singout`
- Содержать REST API для управления ресурсами приложения
- Просмотр контента только автором или если дали доступ (read, write или delete)

Приложение МОЖЕТ:
- Быть построено на `Express`, `Fastify` или `Nest`
- Использовать `PostgreSQL` или `MongoDB`
- Иметь дополнительные функции, такие как поиск по сайту по запросу, загрузка файлов и т.д.

## Планируемый итоговая дизайн система

Цель разработать мискросервисную систему, с разным набором технологий, и научиться связывать это вместе.

Нужно сделать монорепу, разместить там следующие подсистемы:

#### Сервер:
| Название | База данных | Фреймворк | ORM | Описание |
| - | - | - | - | - |
| `microservices/auth` | `PostgreSQL` или `MongoDB` | `Express` | - | Модуль для аутентификации и авторизации |
| `microservices/content` | `MongoDB` | `Nest`, `FirstAPI` (с генерацией контроллеров на основе `OpenAPI`) | `TypeORM` | Отвечает за работы с страницами и контентом |
| `microservises/tasks` | `PostgreSQL` | `Nest` с `NestJS tRPC` | `PrismaORM` | Управление задачами. Есть одна загвоздка, задачи по сути должны наследоваться от `blocks` из `microservises/content`, надо продумать как |
| `microservises/messages` | `MongoDB` | `Fastify`, `GraphQL` | `Mongoose` | Хранит в себе комментарии от заметок и задач, использовать `WebSocket` для обновления комментариев. Сам модуль может использовать не только для комментариев, но и для написания чата |
| `microservises/calendar` | `PostgreSQL` | `Nest` писать котроллеры вручную, и генерировать из них `OpenAPI` | ? | Управление событиями, написать с использованием `WebSocket`. Сами события можно привязывать к задачам, например когда нужно выполнить |

<!-- Не хватает проекта Nest GraphQL -->

#### Клиент:
| Название | Фреймворк | Описание |
| - | - | - |
| `apps/landing` | `nextjs` | Будут обычные две страница главная и вход, вход будет использовать микросервис `auth` |
| `apps/app` | `react` and `vite` | Сама система для создания заметок |

#### Вопросы:
- Подумать где будут воркспейсы? В content или auth?
- По поводу микросервисов, понять можно ли использовать микросервисы из nest.js, чтобы работать с микросервисом на express.
- Если я правильно думаю, микросервисы никак не должны взаимодействовать между собой на уровне раздела microservise, только на уровне выше в разделе apps?
- Какое участие может принять в заимодействии этих микросервисов с RPC?
- Нужно еще подумать как это все развернуть.
- Как сделать общий Swagger? Нужно как-то подключить на подобии postman, чтобы там писать OpenAPI
- Как при изменение OpenAPI запускать генерацию нового клиента и сервера?
- Нужно микосервисы объеденить какием то API Gateway или можно на уровне клиента сделать?

#### Микросервисная архитектура:
- Добавить слой API Gateway для управления запросами между сервисами
- Продумать механизм межсервисного взаимодействия (gRPC, REST, RabbitMQ)

#### Тестирование:
- Добавить unit-тесты для каждого сервиса
- Реализовать интеграционные тесты
- Продумать нагрузочное тестирование

#### Развертывание:
- Использовать Docker для контейнеризации
- Настроить CI/CD pipeline
- Продумать стратегию деплоя

## Основные сущности и их связи
Разбито по базам сервисов и расписанно в условном синтоксисе:

База `auth`:
```
users {
  id: int;
  name: string;
  nikname: string;
  email: string;
}
```

База `content`:
```
spaces {
  id: int;
  name: string;
  owner_user_id: int;
}
sections {
  id: int;
  space_id: int;
  block_id: int;
}
blocks {
  id: int;
  name: string;
  type: 'section' || 'page' || 'page_task' || 'paragraph';
  body: string;
}
related_blocks {
  id: int;
  parent_id: int;
  child_id: int;
  order: float;
}
access_blocks {
  id: int;
  block_id: int;
  user_id: int;
}
```
- Добавить версионирование контента

База `tasks`:
```
tasks {
  id: int;
  name: string;
  responsible_id: int;
  block_id: int;
}
statuses {
  id: int;
  name: string;
  type: 'backlog' || 'todo' || 'progress' || 'done' || 'delete' || 'archive';
  space_id: int;
}
tasks_statuses {
  id: int;
  order: float;
  task_id: int;
  status_id: int;
} 
boards {
  id: int;
  name: string;
  space_id: int;
}
boards_statuses {
  id: int;
  board_id: int;
  status_id: int;
  order: float;
}
```
- Продумать наследование от блоков `content`

База `messages`:
```
rooms {
  id: int;
}
members {
  id: int;
  room_id: int;
  user_id: int;
}
messages {
  id: int;
  body: int;
  room_id: int;
  member_id: int;
}
```

База `calendar`:
```
calendars {
  id: int;
  name: string;
  user_id: int;
}
events {
  id: int;
  calendar_id: int;
}
```

- Интегрировать с задачами

## API и тестирование
Начну разработку с `microservises/content`, по этому приведу пример тестирования API.

Условнное API.


## Генерация

Сделать генерацию контроллеров для nestjs по openapi

https://notiz.dev/blog/openapi-in-nestjs

https://docs.nestjs.com/openapi/introduction